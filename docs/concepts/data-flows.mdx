---
title: "Data Flows"
description: "Visual workflows showing how data moves through CLEO operations"
icon: "diagram-project"
---

# Data Flows

This page visualizes how data moves through CLEO during key operations.

## Task Creation Flow

<Steps>
  <Step title="User Input">
    User runs `cleo add "Task title" --priority high`
  </Step>
  <Step title="Input Validation">
    CLI validates required fields and format
  </Step>
  <Step title="ID Generation">
    System generates unique task ID (T###)
  </Step>
  <Step title="Atomic Write">
    Task written using atomic pattern
  </Step>
  <Step title="Audit Log">
    Operation logged to `todo-log.jsonl`
  </Step>
</Steps>

## Atomic Write Pattern

Every write operation in CLEO follows this pattern:

```mermaid
flowchart TB
    subgraph Input
        A[Write Request] --> B{Validate Input}
    end

    subgraph Processing
        B -->|Valid| C[Write to temp file]
        B -->|Invalid| X[Return Error]
        C --> D[Schema Validation]
        D -->|Pass| E[Create Backup]
        D -->|Fail| Y[Delete Temp + Return Error]
        E --> F[Atomic Rename]
    end

    subgraph Output
        F --> G[Log Operation]
        G --> H[Return Success]
    end

    style A fill:#0D9373
    style H fill:#07C983
    style X fill:#e74c3c
    style Y fill:#e74c3c
```

<Info>
This pattern ensures no partial writes - the operation either fully succeeds or the original file is preserved.
</Info>

## Validation Layers

<Tabs>
  <Tab title="Schema">
    JSON Schema validation ensures correct data types, required fields, and enum values.
  </Tab>
  <Tab title="Semantic">
    Cross-file checks for ID uniqueness, valid references, and cycle detection.
  </Tab>
  <Tab title="Temporal">
    Timestamp validation prevents future dates and ensures logical ordering.
  </Tab>
  <Tab title="Content">
    Content validation ensures meaningful data (title != description).
  </Tab>
</Tabs>

## Session State Machine

Sessions transition through defined states:

```mermaid
stateDiagram-v2
    direction LR
    [*] --> active: session start
    active --> suspended: session suspend
    active --> ended: session end
    suspended --> active: session resume
    ended --> active: session resume
    ended --> closed: session close
    closed --> [*]

    note right of active: Terminal bound
    note right of closed: Permanent archive
```

## Task Lifecycle

```mermaid
stateDiagram-v2
    [*] --> pending: cleo add
    pending --> active: cleo focus set
    pending --> blocked: --blocked-by
    active --> pending: cleo focus clear
    active --> done: cleo complete
    blocked --> pending: dependency resolved
    blocked --> active: cleo focus set
    done --> [*]
    done --> pending: cleo reopen

    note right of active: Only ONE task active per scope
    note right of done: Archive via cleo archive
```

## Backup System

```mermaid
flowchart LR
    subgraph "Tier 1: Operational"
        A[atomic_write] --> B[backup_file]
        B --> C[.backups/todo.json.1-10]
    end

    subgraph "Tier 2: Recovery"
        D[Manual backup] --> E[create_snapshot_backup]
        F[Pre-destructive] --> G[create_safety_backup]
        E --> H[.cleo/backups/snapshot/]
        G --> I[.cleo/backups/safety/]
    end

    style A fill:#0D9373
    style D fill:#0D9373
    style F fill:#0D9373
```

## Related Concepts

<CardGroup cols={2}>
  <Card title="Architecture" icon="cubes" href="/concepts/architecture">
    System design and components
  </Card>
  <Card title="Anti-Hallucination" icon="shield" href="/concepts/anti-hallucination">
    Validation mechanisms in detail
  </Card>
</CardGroup>
