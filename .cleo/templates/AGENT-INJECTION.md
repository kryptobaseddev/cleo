## Task Management (cleo)

Use `ct` (alias for `cleo`) for task operations. Global architecture: `~/.cleo/templates/CLEO-INJECTION.md`

**Multi-Agent**: Auto-injected into CLAUDE.md, AGENTS.md, GEMINI.md. Update: `ct init --update-docs`

### CRITICAL: Error Handling
**NEVER ignore exit codes. Failed commands = tasks NOT created/updated.**

**After EVERY command:**
1. Exit code: `0` = success, `1-22` = error, `100+` = special (not error)
2. JSON: `"success": false` = operation failed
3. Execute `error.fix` - Copy-paste-ready fix command
4. Or use `error.alternatives` - Array of {action, command} options

**Critical Errors:**
| Exit | Code | Fix |
|:----:|------|-----|
| 4 | `E_NOT_FOUND` | Use `ct find` or `ct list` to verify |
| 6 | `E_VALIDATION_*` | Check field lengths, escape `$` as `\$` |
| 10 | `E_PARENT_NOT_FOUND` | Verify with `ct exists <parent-id>` |
| 11 | `E_DEPTH_EXCEEDED` | Max depth 3 (epic->task->subtask) |
| 12 | `E_SIBLING_LIMIT` | Max 7 siblings per parent |
| 38 | `E_FOCUS_REQUIRED` | Add `--auto-focus` to session start |
| 100 | `E_SESSION_DISCOVERY_MODE` | Add `--scope epic:<id>` + run `ct session list` first |

**Shell escaping:**
```bash
ct update T001 --notes "Price: \$395"  # Correct
ct update T001 --notes "Price: $395"   # WRONG - $395 interpreted as variable
```

### Essential Commands
```bash
ct find "query"            # Fuzzy search (99% less context than list)
ct find --id 142           # ID search (multiple matches)
ct show T1234              # Full task details
ct add "Task"              # Create task
ct done <id>               # Complete task
ct focus set <id>          # Set active task
ct session list            # Check sessions FIRST
ct session status          # Current session
ct dash                    # Project overview
ct context                 # Context window usage
ct issue bug --title "..." --body "..."   # File a bug report
ct issue diagnostics       # Show system diagnostics
```

### Session Protocol

**CRITICAL: Multi-session requires BOTH flags:**
```bash
ct session start --scope epic:T001 --auto-focus --name "Name"
#                ^ REQUIRED         ^ REQUIRED (or --focus T005)
```

**START (ALWAYS first):**
```bash
ct session list              # <- CHECK FIRST
ct session status            # Current session
ct session resume <id>       # Resume existing
# OR (only if no suitable session):
ct session start --scope epic:T001 --auto-focus --name "Work"
```

**WORK:**
```bash
ct focus show                # Current focus
ct next                      # Task suggestion
ct add "Task" --depends T005 # Add related
ct complete T005             # Complete task
ct focus set T006            # Next task
```

**END (ALWAYS when stopping):**
```bash
ct complete <id>             # Complete current
ct archive                   # Clean up done tasks
ct session end --note "Progress"  # <- ALWAYS END
```

### Task Discovery (Context Efficiency)
**MUST** use efficient commands:
```bash
ct find "query"              # Minimal fields (99% less context)
ct find --id 1234            # ID search (returns multiple)
ct show T1234                # Full details for specific task
ct list --parent T001        # Direct children only
```

**Why `find` > `list`:** `list` includes full notes arrays (huge). `find` returns minimal fields only. **MUST** use `find` for discovery, `show` for details.

### Project Context (Auto-Detected)

When available, project-specific configuration and LLM hints are loaded from:

@.cleo/project-context.json

This file is generated by `cleo init --detect` and contains detected project type, testing framework, framework-specific patterns, and LLM hints.

**Note**: If the file doesn't exist, run `cleo init --detect` to generate it.

### Skill Ecosystem

For detailed workflow guidance, use the skill system:

```bash
ct commands -r critical      # Essential commands
skill list                   # Available skills
skill show ct-orchestrator   # Skill details
```

**Key skills**: `ct-orchestrator` (HITL workflows), `ct-epic-architect` (planning), `ct-task-executor` (general execution), `ct-validator` (quality checks).

Full architecture: `~/.cleo/templates/CLEO-INJECTION.md`
