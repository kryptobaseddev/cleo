/**
 * Unified CQRS Dispatch Layer -- Operation Registry
 *
 * Single source of truth for all 147 operations mapped to 9 canonical domains.
 * Canonical domains only -- no legacy alias support.
 *
 * @epic T4820
 * @task T4814
 */

import { Gateway, Tier, CanonicalDomain } from './types.js';

/** Definition of a single dispatchable operation. */
export interface OperationDef {
  /** The CQRS gateway ('query' or 'mutate'). */
  gateway: Gateway;
  /** The canonical domain this operation belongs to. */
  domain: CanonicalDomain;
  /** The specific operation name (e.g. 'show', 'skill.list'). */
  operation: string;
  /** Brief description of what the operation does. */
  description: string;
  /** Agent progressive-disclosure tier (0=basic, 1=memory/check, 2=full). */
  tier: Tier;
  /** Whether the operation is safe to retry. */
  idempotent: boolean;
  /** Whether this operation requires an active session. */
  sessionRequired: boolean;
  /** List of parameter keys that MUST be present in the request. */
  requiredParams: string[];
}

/**
 * Resolution output for a dispatch request.
 */
export interface Resolution {
  /** The canonical domain. */
  domain: CanonicalDomain;
  /** The operation name. */
  operation: string;
  /** The definition of the matched operation. */
  def: OperationDef;
}

/**
 * The single source of truth for all operations in CLEO.
 */
export const OPERATIONS: OperationDef[] = [
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'show',
    description: 'tasks.show (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'list',
    description: 'tasks.list (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'find',
    description: 'tasks.find (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'exists',
    description: 'tasks.exists (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'tree',
    description: 'tasks.tree (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'blockers',
    description: 'tasks.blockers (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'depends',
    description: 'tasks.depends (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'analyze',
    description: 'tasks.analyze (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'next',
    description: 'tasks.next (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'relates',
    description: 'tasks.relates (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'complexity.estimate',
    description: 'tasks.complexity.estimate (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tasks',
    operation: 'current',
    description: 'tasks.current (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'session',
    operation: 'status',
    description: 'session.status (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'session',
    operation: 'list',
    description: 'session.list (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'session',
    operation: 'show',
    description: 'session.show (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'session',
    operation: 'history',
    description: 'session.history (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'session',
    operation: 'decision.log',
    description: 'session.decision.log (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'session',
    operation: 'context.drift',
    description: 'session.context.drift (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'status',
    description: 'orchestrate.status (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'next',
    description: 'orchestrate.next (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'ready',
    description: 'orchestrate.ready (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'analyze',
    description: 'orchestrate.analyze (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'context',
    description: 'orchestrate.context (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'waves',
    description: 'orchestrate.waves (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'skill.list',
    description: 'orchestrate.skill.list (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'bootstrap',
    description: 'orchestrate.bootstrap (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'unblock.opportunities',
    description: 'orchestrate.unblock.opportunities (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'orchestrate',
    operation: 'critical.path',
    description: 'orchestrate.critical.path (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'memory',
    operation: 'show',
    description: 'memory.show (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'memory',
    operation: 'list',
    description: 'memory.list (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'memory',
    operation: 'find',
    description: 'memory.find (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'memory',
    operation: 'pending',
    description: 'memory.pending (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'memory',
    operation: 'stats',
    description: 'memory.stats (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'memory',
    operation: 'manifest.read',
    description: 'memory.manifest.read (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'memory',
    operation: 'contradictions',
    description: 'memory.contradictions (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'memory',
    operation: 'superseded',
    description: 'memory.superseded (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'pipeline',
    operation: 'stage.validate',
    description: 'pipeline.stage.validate (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'pipeline',
    operation: 'stage.status',
    description: 'pipeline.stage.status (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'pipeline',
    operation: 'stage.history',
    description: 'pipeline.stage.history (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'pipeline',
    operation: 'stage.gates',
    description: 'pipeline.stage.gates (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'pipeline',
    operation: 'stage.prerequisites',
    description: 'pipeline.stage.prerequisites (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'schema',
    description: 'check.schema (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'protocol',
    description: 'check.protocol (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'task',
    description: 'check.task (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'manifest',
    description: 'check.manifest (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'output',
    description: 'check.output (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'compliance.summary',
    description: 'check.compliance.summary (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'compliance.violations',
    description: 'check.compliance.violations (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'test.status',
    description: 'check.test.status (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'test.coverage',
    description: 'check.test.coverage (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'check',
    operation: 'coherence.check',
    description: 'check.coherence.check (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'version',
    description: 'admin.version (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'health',
    description: 'admin.health (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'config.get',
    description: 'admin.config.get (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'stats',
    description: 'admin.stats (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'context',
    description: 'admin.context (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'job.status',
    description: 'admin.job.status (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'job.list',
    description: 'admin.job.list (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'dash',
    description: 'admin.dash (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'log',
    description: 'admin.log (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'admin',
    operation: 'sequence',
    description: 'admin.sequence (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'issue.diagnostics',
    description: 'tools.issue.diagnostics (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'issue.templates',
    description: 'List available issue templates',
    tier: 2,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'issue.validate.labels',
    description: 'Validate issue labels against configured label set',
    tier: 2,
    idempotent: true,
    sessionRequired: false,
    requiredParams: ['labels'],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.list',
    description: 'tools.skill.list (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.show',
    description: 'tools.skill.show (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.find',
    description: 'tools.skill.find (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.dispatch',
    description: 'tools.skill.dispatch (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.verify',
    description: 'tools.skill.verify (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.dependencies',
    description: 'tools.skill.dependencies (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.catalog.protocols',
    description: 'List CAAMP protocol definitions',
    tier: 2,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.catalog.profiles',
    description: 'List CAAMP dispatch profiles',
    tier: 2,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.catalog.resources',
    description: 'List CAAMP shared resources',
    tier: 2,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'skill.catalog.info',
    description: 'Get CAAMP catalog metadata',
    tier: 2,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'provider.list',
    description: 'tools.provider.list (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'provider.detect',
    description: 'tools.provider.detect (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'query',
    domain: 'tools',
    operation: 'provider.inject.status',
    description: 'tools.provider.inject.status (query)',
    tier: 0,
    idempotent: true,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'add',
    description: 'tasks.add (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'update',
    description: 'tasks.update (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'complete',
    description: 'tasks.complete (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'delete',
    description: 'tasks.delete (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'archive',
    description: 'tasks.archive (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'restore',
    description: 'tasks.restore (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'reparent',
    description: 'tasks.reparent (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'promote',
    description: 'tasks.promote (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'reorder',
    description: 'tasks.reorder (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'reopen',
    description: 'tasks.reopen (mutate) â€” alias for tasks.restore',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'relates.add',
    description: 'tasks.relates.add (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'start',
    description: 'tasks.start (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tasks',
    operation: 'stop',
    description: 'tasks.stop (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'session',
    operation: 'start',
    description: 'session.start (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'session',
    operation: 'end',
    description: 'session.end (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'session',
    operation: 'resume',
    description: 'session.resume (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'session',
    operation: 'suspend',
    description: 'session.suspend (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'session',
    operation: 'gc',
    description: 'session.gc (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'session',
    operation: 'record.decision',
    description: 'session.record.decision (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'session',
    operation: 'record.assumption',
    description: 'session.record.assumption (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'orchestrate',
    operation: 'start',
    description: 'orchestrate.start (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'orchestrate',
    operation: 'spawn',
    description: 'orchestrate.spawn (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'orchestrate',
    operation: 'validate',
    description: 'orchestrate.validate (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'orchestrate',
    operation: 'parallel.start',
    description: 'orchestrate.parallel.start (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'orchestrate',
    operation: 'parallel.end',
    description: 'orchestrate.parallel.end (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'memory',
    operation: 'inject',
    description: 'memory.inject (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'memory',
    operation: 'link',
    description: 'memory.link (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'memory',
    operation: 'manifest.append',
    description: 'memory.manifest.append (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'memory',
    operation: 'manifest.archive',
    description: 'memory.manifest.archive (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'stage.record',
    description: 'pipeline.stage.record (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'stage.skip',
    description: 'pipeline.stage.skip (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'stage.reset',
    description: 'pipeline.stage.reset (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'stage.gate.pass',
    description: 'pipeline.stage.gate.pass (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'stage.gate.fail',
    description: 'pipeline.stage.gate.fail (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'check',
    operation: 'compliance.record',
    description: 'check.compliance.record (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'check',
    operation: 'test.run',
    description: 'check.test.run (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'release.prepare',
    description: 'pipeline.release.prepare (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'release.changelog',
    description: 'pipeline.release.changelog (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'release.commit',
    description: 'pipeline.release.commit (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'release.tag',
    description: 'pipeline.release.tag (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'release.push',
    description: 'pipeline.release.push (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'release.gates.run',
    description: 'pipeline.release.gates.run (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'pipeline',
    operation: 'release.rollback',
    description: 'pipeline.release.rollback (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'init',
    description: 'admin.init (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'config.set',
    description: 'admin.config.set (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'backup',
    description: 'admin.backup (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'restore',
    description: 'admin.restore (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'migrate',
    description: 'admin.migrate (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'sync',
    description: 'admin.sync (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'cleanup',
    description: 'admin.cleanup (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'job.cancel',
    description: 'admin.job.cancel (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'safestop',
    description: 'admin.safestop (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'admin',
    operation: 'inject.generate',
    description: 'admin.inject.generate (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'issue.add.bug',
    description: 'tools.issue.add.bug (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'issue.add.feature',
    description: 'tools.issue.add.feature (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'issue.add.help',
    description: 'tools.issue.add.help (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'issue.generate.config',
    description: 'Generate issue template configuration file',
    tier: 2,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'skill.install',
    description: 'tools.skill.install (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'skill.uninstall',
    description: 'tools.skill.uninstall (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'skill.enable',
    description: 'tools.skill.enable (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'skill.disable',
    description: 'tools.skill.disable (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'skill.configure',
    description: 'tools.skill.configure (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'skill.refresh',
    description: 'tools.skill.refresh (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
  {
    gateway: 'mutate',
    domain: 'tools',
    operation: 'provider.inject',
    description: 'tools.provider.inject (mutate)',
    tier: 0,
    idempotent: false,
    sessionRequired: false,
    requiredParams: [],
  },
];

// ---------------------------------------------------------------------------
// Lookup & Validation
// ---------------------------------------------------------------------------

/**
 * Resolves a domain + operation to its registered definition.
 */
export function resolve(gateway: Gateway, domain: string, operation: string): Resolution | undefined {
  const def = OPERATIONS.find(
    o => o.gateway === gateway && o.domain === domain && o.operation === operation,
  );

  if (!def) return undefined;

  return { domain: def.domain, operation: def.operation, def };
}

/**
 * Validates that all required parameters are present in the request.
 * Returns an array of missing parameter keys.
 */
export function validateRequiredParams(def: OperationDef, params?: Record<string, unknown>): string[] {
  if (!def.requiredParams || def.requiredParams.length === 0) return [];
  const provided = params || {};
  return def.requiredParams.filter(key => provided[key] === undefined || provided[key] === null || provided[key] === '');
}

/** Get all operations for a specific canonical domain. */
export function getByDomain(domain: CanonicalDomain): OperationDef[] {
  return OPERATIONS.filter(o => o.domain === domain);
}

/** Get all operations for a specific gateway. */
export function getByGateway(gateway: Gateway): OperationDef[] {
  return OPERATIONS.filter(o => o.gateway === gateway);
}

/** Get all operations available at or below a specific tier. */
export function getByTier(tier: Tier): OperationDef[] {
  return OPERATIONS.filter(o => o.tier <= tier);
}

/** Get a list of canonical domains that actually have operations registered. */
export function getActiveDomains(): CanonicalDomain[] {
  const active = new Set(OPERATIONS.map(o => o.domain));
  return Array.from(active);
}

/**
 * Returns summary counts of operations for module validation.
 */
export function getCounts(): { query: number; mutate: number; total: number } {
  return {
    query: OPERATIONS.filter(o => o.gateway === 'query').length,
    mutate: OPERATIONS.filter(o => o.gateway === 'mutate').length,
    total: OPERATIONS.length,
  };
}

// Module load validation
const counts = getCounts();
if (counts.query !== 77 || counts.mutate !== 64) {
  console.warn(`[Registry] Expected 77 query & 64 mutate ops, got ${counts.query} query & ${counts.mutate} mutate.`);
}
