# CLEO-CAAMP Function Mapping

**Research Task**: Map every bash library function that CAAMP replaces
**Date**: 2026-02-11
**Status**: complete

---

## Summary

- **Total bash functions cataloged**: 152
- **CAAMP-replaceable (pending V2 conversion)**: 104
- **CLEO-only (stays in bash, n/a)**: 48
- **Already converted to CAAMP**: 0

**No existing CAAMP usage found** in the CLEO codebase. The `mcp-server/package.json` has no `@cleocode/caamp` dependency. No TypeScript imports reference CAAMP. The CAAMP epic (T4332) is in `pending` status.

---

## Domain: Provider/Agent Registry

### Bash Functions (lib/agent-registry.sh) - 23 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `ar_load_registry` | lib/agent-registry.sh | Load agent registry JSON into cache | `providerRegistry.load()` | pending |
| `_ar_ensure_loaded` | lib/agent-registry.sh | Lazy-load registry if not cached | Internal to CAAMP registry class | pending |
| `ar_list_agents` | lib/agent-registry.sh | List all agent IDs from registry | `providerRegistry.listProviders()` | pending |
| `ar_list_by_tier` | lib/agent-registry.sh | List agents filtered by priority tier | `providerRegistry.listByTier()` | pending |
| `ar_list_by_instruction_file` | lib/agent-registry.sh | List agents by instruction file name | `providerRegistry.listByInstructionFile()` | pending |
| `ar_get_agent` | lib/agent-registry.sh | Get full agent config JSON object | `providerRegistry.getProvider()` | pending |
| `ar_get_field` | lib/agent-registry.sh | Get specific field from agent config | `providerRegistry.getField()` | pending |
| `ar_agent_exists` | lib/agent-registry.sh | Check if agent exists in registry | `providerRegistry.exists()` | pending |
| `ar_get_global_dir` | lib/agent-registry.sh | Get agent global directory (expands $HOME) | `providerRegistry.getGlobalDir()` | pending |
| `ar_get_project_dir` | lib/agent-registry.sh | Get agent project-relative directory | `providerRegistry.getProjectDir()` | pending |
| `ar_get_instruction_file` | lib/agent-registry.sh | Get agent instruction filename | `providerRegistry.getInstructionFile()` | pending |
| `ar_get_global_instruction_path` | lib/agent-registry.sh | Get full path to global instruction file | `providerRegistry.getGlobalInstructionPath()` | pending |
| `ar_get_project_instruction_path` | lib/agent-registry.sh | Get full path to project instruction file | `providerRegistry.getProjectInstructionPath()` | pending |
| `ar_get_global_skills_dir` | lib/agent-registry.sh | Get global skills directory path | `providerRegistry.getGlobalSkillsDir()` | pending |
| `ar_get_project_skills_dir` | lib/agent-registry.sh | Get project skills directory path | `providerRegistry.getProjectSkillsDir()` | pending |
| `ar_is_installed` | lib/agent-registry.sh | Check if agent CLI is installed | `providerRegistry.isInstalled()` | pending |
| `ar_list_installed` | lib/agent-registry.sh | List all installed agent IDs | `providerRegistry.listInstalled()` | pending |
| `ar_list_installed_by_tier` | lib/agent-registry.sh | List installed agents filtered by tier | `providerRegistry.listInstalledByTier()` | pending |
| `ar_get_display_name` | lib/agent-registry.sh | Get agent display name | `providerRegistry.getDisplayName()` | pending |
| `ar_get_vendor` | lib/agent-registry.sh | Get agent vendor | `providerRegistry.getVendor()` | pending |
| `ar_get_priority` | lib/agent-registry.sh | Get agent priority level | `providerRegistry.getPriority()` | pending |
| `ar_get_status` | lib/agent-registry.sh | Get agent status | `providerRegistry.getStatus()` | pending |
| `ar_is_agent_skills_compatible` | lib/agent-registry.sh | Check Agent Skills marketplace compatibility | `providerRegistry.isSkillsCompatible()` | pending |
| `ar_get_instruction_files` | lib/agent-registry.sh | Get unique instruction file names | `providerRegistry.getInstructionFiles()` | pending |
| `ar_get_registry_json` | lib/agent-registry.sh | Get full registry as JSON | `providerRegistry.toJSON()` | pending |
| `ar_get_agent_summary` | lib/agent-registry.sh | Get agent summary as JSON | `providerRegistry.getSummary()` | pending |
| `ar_list_agents_json` | lib/agent-registry.sh | List all agents as JSON array | `providerRegistry.listProvidersJSON()` | pending |

### Notes
- This entire file maps to CAAMP's `provider-registry` module
- CAAMP should provide a `ProviderRegistry` class that loads from JSON schema and provides typed accessors
- Path expansion ($HOME) must be handled in the TypeScript layer

---

## Domain: Agent Configuration (lib/agent-config.sh) - 22 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `load_agent_registry` | lib/agent-config.sh | Load agent registry JSON from schema file | `providerConfig.load()` | pending |
| `normalize_agent_id` | lib/agent-config.sh | Handle legacy agent name aliases | `providerConfig.normalizeId()` | pending |
| `get_agent_dir` | lib/agent-config.sh | Get agent directory with $HOME expansion | `providerConfig.getDir()` | pending |
| `get_agent_config_file` | lib/agent-config.sh | Get agent config filename | `providerConfig.getConfigFile()` | pending |
| `get_all_agents` | lib/agent-config.sh | Get all agent IDs from registry | `providerConfig.listAll()` | pending |
| `get_agents_by_tier` | lib/agent-config.sh | Get agents by priority tier | `providerConfig.listByTier()` | pending |
| `get_agent_skills_dir` | lib/agent-config.sh | Get agent skills directory (relative) | `providerConfig.getSkillsDir()` | pending |
| `get_agent_project_skills_dir` | lib/agent-config.sh | Get project-level skills directory | `providerConfig.getProjectSkillsDir()` | pending |
| `get_agent_global_skills_dir` | lib/agent-config.sh | Get global skills directory (absolute) | `providerConfig.getGlobalSkillsDir()` | pending |
| `get_skill_install_path` | lib/agent-config.sh | Get where skill would be installed | `providerConfig.getSkillInstallPath()` | pending |
| `install_skill_to_agent` | lib/agent-config.sh | Copy skill directory to agent location | `providerConfig.installSkill()` | pending |
| `list_agent_skills` | lib/agent-config.sh | List installed skills for agent | `providerConfig.listSkills()` | pending |
| `is_skill_installed` | lib/agent-config.sh | Check if skill is installed for agent | `providerConfig.isSkillInstalled()` | pending |
| `uninstall_skill_from_agent` | lib/agent-config.sh | Remove skill from agent directory | `providerConfig.uninstallSkill()` | pending |
| `get_agent_config_json` | lib/agent-config.sh | Get full agent config as JSON | `providerConfig.getJSON()` | pending |
| `get_agent_display_name` | lib/agent-config.sh | Get agent display name | `providerConfig.getDisplayName()` | pending |
| `update_agent_config_registry` | lib/agent-config.sh | Update registry with version info | `providerConfig.updateRegistry()` | pending |
| `get_agent_config_version` | lib/agent-config.sh | Get config version from file (legacy) | `providerConfig.getVersion()` | pending |
| `validate_agent_config_registry` | lib/agent-config.sh | Validate registry JSON structure | `providerConfig.validate()` | pending |
| `is_agent_registered` | lib/agent-config.sh | Check if agent is in config registry | `providerConfig.isRegistered()` | pending |
| `get_agent_config_data` | lib/agent-config.sh | Get agent config data from registry | `providerConfig.getData()` | pending |
| `list_agent_configs` | lib/agent-config.sh | List all registered agent configs | `providerConfig.listConfigs()` | pending |
| `get_agent_name_from_path` | lib/agent-config.sh | Resolve agent ID from file path | `providerConfig.resolveFromPath()` | pending |
| `is_agent_cli_installed` | lib/agent-config.sh | Check if agent CLI directory exists | `providerConfig.isCLIInstalled()` | pending |
| `get_agent_config_path` | lib/agent-config.sh | Get full path to agent config file | `providerConfig.getConfigPath()` | pending |
| `create_empty_agent_registry` | lib/agent-config.sh | Initialize empty agent config registry | `providerConfig.initRegistry()` | pending |
| `init_agent_config_registry` | lib/agent-config.sh | Initialize registry if missing | `providerConfig.ensureInit()` | pending |

### Notes
- Significant overlap with agent-registry.sh; CAAMP should consolidate these into a single ProviderRegistry + ProviderConfig module
- `normalize_agent_id()` handles "claude" -> "claude-code" alias mapping -- important for backward compatibility
- Skill installation operations (install_skill_to_agent, uninstall_skill_from_agent) could move to CAAMP's skills module

---

## Domain: MCP Configuration (lib/mcp-config.sh) - 30 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `_mcp_display_name` | lib/mcp-config.sh | Get display name for tool key | `mcpConfig.getDisplayName()` | pending |
| `_mcp_format` | lib/mcp-config.sh | Get config format (standard/goose/etc) | `mcpConfig.getFormat()` | pending |
| `_mcp_config_key` | lib/mcp-config.sh | Get top-level JSON key for MCP servers | `mcpConfig.getConfigKey()` | pending |
| `_mcp_binary` | lib/mcp-config.sh | Get binary name for tool detection | `mcpConfig.getBinaryName()` | pending |
| `_mcp_config_dir` | lib/mcp-config.sh | Get config directories for detection | `mcpConfig.getConfigDirs()` | pending |
| `_mcp_app_bundle` | lib/mcp-config.sh | Get macOS app bundle name | `mcpConfig.getAppBundle()` | pending |
| `_mcp_flatpak_id` | lib/mcp-config.sh | Get Flatpak app ID for detection | `mcpConfig.getFlatpakId()` | pending |
| `_mcp_get_config_path` | lib/mcp-config.sh | Get config file path for tool+scope | `mcpConfig.getConfigPath()` | pending |
| `_mcp_has_dual_scope` | lib/mcp-config.sh | Check if tool supports project+global | `mcpConfig.hasDualScope()` | pending |
| `mcp_detect_tool` | lib/mcp-config.sh | Detect a single tool installation | `mcpConfig.detectTool()` | pending |
| `mcp_detect_all_tools` | lib/mcp-config.sh | Detect all installed tools | `mcpConfig.detectAllTools()` | pending |
| `mcp_generate_entry` | lib/mcp-config.sh | Generate MCP server entry JSON | `mcpConfig.generateEntry()` | pending |
| `_mcp_merge_standard` | lib/mcp-config.sh | Merge into standard JSON format | `mcpConfig.mergeStandard()` | pending |
| `_mcp_merge_opencode` | lib/mcp-config.sh | Merge into OpenCode format | `mcpConfig.mergeOpenCode()` | pending |
| `_mcp_merge_vscode` | lib/mcp-config.sh | Merge into VS Code format | `mcpConfig.mergeVSCode()` | pending |
| `_mcp_merge_zed` | lib/mcp-config.sh | Merge into Zed format | `mcpConfig.mergeZed()` | pending |
| `_mcp_generate_codex_toml_block` | lib/mcp-config.sh | Generate Codex TOML config block | `mcpConfig.generateCodexTOML()` | pending |
| `_mcp_merge_codex_toml` | lib/mcp-config.sh | Merge cleo block into Codex TOML | `mcpConfig.mergeCodexTOML()` | pending |
| `_mcp_generate_goose_yaml_block` | lib/mcp-config.sh | Generate Goose YAML config block | `mcpConfig.generateGooseYAML()` | pending |
| `_mcp_merge_goose_yaml` | lib/mcp-config.sh | Merge cleo block into Goose YAML | `mcpConfig.mergeGooseYAML()` | pending |
| `mcp_backup_external_file` | lib/mcp-config.sh | Backup config file before modification | `mcpConfig.backupFile()` | pending |
| `mcp_write_config` | lib/mcp-config.sh | Write MCP config for specific tool | `mcpConfig.writeConfig()` | pending |
| `mcp_get_tool_keys` | lib/mcp-config.sh | Get all tool keys | `mcpConfig.getToolKeys()` | pending |
| `mcp_get_tool_display_name` | lib/mcp-config.sh | Get display name for tool | `mcpConfig.getToolDisplayName()` | pending |
| `mcp_get_tool_format` | lib/mcp-config.sh | Get format for tool | `mcpConfig.getToolFormat()` | pending |
| `mcp_get_tool_config_key` | lib/mcp-config.sh | Get config key for tool | `mcpConfig.getToolConfigKey()` | pending |
| `mcp_get_config_path` | lib/mcp-config.sh | Get config path for tool | `mcpConfig.getConfigPath()` (public) | pending |
| `mcp_has_dual_scope` | lib/mcp-config.sh | Check dual-scope support | `mcpConfig.hasDualScope()` (public) | pending |
| `mcp_remove_config` | lib/mcp-config.sh | Remove MCP config for tool | `mcpConfig.removeConfig()` | pending |

### Notes
- The `MCP_TOOL_KEYS` array defines 12 supported tools: claude-code, claude-desktop, cursor, gemini-cli, kimi, antigravity, windsurf, goose, opencode, vscode, zed, codex
- Format-specific merge functions handle 6 formats: standard JSON, OpenCode, VS Code, Zed, Codex TOML, Goose YAML
- CAAMP should handle JSONC parsing (comment stripping) and idempotency safety checks
- `mcp_remove_config` was referenced in the file header PROVIDES but may exist in a script layer -- confirmed in exports list

---

## Domain: Skills Installation (lib/skills-install.sh) - 8 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `_init_skills_paths` | lib/skills-install.sh | Initialize CLEO_REPO_ROOT and manifest paths | Internal to CAAMP skills module | pending |
| `get_skills_from_manifest` | lib/skills-install.sh | Get active skill names from manifest | `skillsInstall.listFromManifest()` | pending |
| `get_skill_path` | lib/skills-install.sh | Get skill path from manifest by name | `skillsInstall.getSkillPath()` | pending |
| `install_skill` | lib/skills-install.sh | Install single skill via symlink | `skillsInstall.install()` | pending |
| `install_skills` | lib/skills-install.sh | Install all skills from manifest | `skillsInstall.installAll()` | pending |
| `uninstall_skills` | lib/skills-install.sh | Remove skill symlinks | `skillsInstall.uninstallAll()` | pending |
| `list_installed_skills` | lib/skills-install.sh | List installed skills with status JSON | `skillsInstall.listInstalled()` | pending |

### Notes
- Symlink-based installation to `~/.claude/skills/`
- Reads from `skills/manifest.json` for active skills
- CAAMP should replicate symlink strategy for auto-propagating updates

---

## Domain: Skills Discovery (lib/skill-discovery.sh) - 7 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `extract_skill_metadata` | lib/skill-discovery.sh | Extract metadata from SKILL.md header | `skillsDiscovery.extractMetadata()` | pending |
| `parse_skill_header` | lib/skill-discovery.sh | Parse full skill directory for metadata | `skillsDiscovery.parseHeader()` | pending |
| `discover_skills` | lib/skill-discovery.sh | Scan directory for SKILL.md files | `skillsDiscovery.discover()` | pending |
| `validate_skill` | lib/skill-discovery.sh | Validate skill against protocol requirements | `skillsDiscovery.validate()` | pending |
| `register_skill` | lib/skill-discovery.sh | Register skill in manifest.json | `skillsDiscovery.register()` | pending |
| `sync_manifest` | lib/skill-discovery.sh | Sync manifest with discovered skills | `skillsDiscovery.syncManifest()` | pending |
| `update_dispatch_matrix` | lib/skill-discovery.sh | Update manifest dispatch keywords | `skillsDiscovery.updateDispatchMatrix()` | pending |

### Notes
- Supports two SKILL.md formats: YAML frontmatter and structured header
- Tags are inferred from protocol type (research, decomposition, implementation, specification)
- Manifest sync marks missing skills as deprecated

---

## Domain: Skills Validation (lib/skill-validate.sh) - 10 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `skill_exists` | lib/skill-validate.sh | Check if skill exists in manifest | `skillsValidate.exists()` | pending |
| `skill_is_active` | lib/skill-validate.sh | Check if skill status is "active" | `skillsValidate.isActive()` | pending |
| `skill_has_required_tokens` | lib/skill-validate.sh | Verify skill has needed tokens defined | `skillsValidate.hasRequiredTokens()` | pending |
| `skill_is_compatible_with_subagent` | lib/skill-validate.sh | Check subagent model compatibility | `skillsValidate.isCompatible()` | pending |
| `skill_get_info` | lib/skill-validate.sh | Get skill metadata as JSON | `skillsValidate.getInfo()` | pending |
| `skill_list_all` | lib/skill-validate.sh | List all skills (with optional filter) | `skillsValidate.listAll()` | pending |
| `skill_validate_for_spawn` | lib/skill-validate.sh | Full validation before spawning | `skillsValidate.validateForSpawn()` | pending |
| `skill_get_path` | lib/skill-validate.sh | Get skill directory path | `skillsValidate.getPath()` | pending |
| `skill_get_tags` | lib/skill-validate.sh | Get skill tags | `skillsValidate.getTags()` | pending |
| `skill_find_by_tag` | lib/skill-validate.sh | Find skills with specific tag | `skillsValidate.findByTag()` | pending |

### Notes
- All reads from `skills/manifest.json` (single source of truth)
- Model compatibility: sonnet skills can run on opus (upward compatibility)
- Token validation checks against `skills/_shared/placeholders.json`

---

## Domain: Skills Versioning (lib/skills-version.sh) - 8 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `init_installed_skills` | lib/skills-version.sh | Initialize installed-skills.json tracking file | `skillsVersion.init()` | pending |
| `record_skill_version` | lib/skills-version.sh | Record installed skill version | `skillsVersion.recordVersion()` | pending |
| `get_installed_version` | lib/skills-version.sh | Get installed version of skill | `skillsVersion.getInstalledVersion()` | pending |
| `check_skill_updates` | lib/skills-version.sh | Compare manifest vs installed versions | `skillsVersion.checkUpdates()` | pending |
| `apply_skill_updates` | lib/skills-version.sh | Apply version updates from JSON array | `skillsVersion.applyUpdates()` | pending |
| `get_skill_update_count` | lib/skills-version.sh | Count of skills with updates available | `skillsVersion.getUpdateCount()` | pending |
| `format_skill_updates` | lib/skills-version.sh | Format updates for human display | `skillsVersion.formatUpdates()` | pending |
| `record_all_manifest_skills` | lib/skills-version.sh | Record all current manifest skills | `skillsVersion.recordAll()` | pending |

### Notes
- Tracks installed versions in `~/.cleo/installed-skills.json`
- Compares against `skills/manifest.json` for upgrade detection
- CAAMP should provide a lock file mechanism (similar to package-lock.json concept)

---

## Domain: Skills Marketplace (lib/skillsmp.sh) - 5 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `smp_load_config` | lib/skillsmp.sh | Load skillsmp.json configuration | `skillsMarketplace.loadConfig()` | pending |
| `smp_search_skills` | lib/skillsmp.sh | Search skills by query on agentskills.in | `skillsMarketplace.search()` | pending |
| `smp_get_skill_details` | lib/skillsmp.sh | Get skill details by scoped name | `skillsMarketplace.getDetails()` | pending |
| `smp_download_skill` | lib/skillsmp.sh | Download skill content from GitHub | `skillsMarketplace.download()` | pending |
| `smp_install_skill` | lib/skillsmp.sh | Install skill from marketplace | `skillsMarketplace.install()` | pending |

### Notes
- API endpoint: `https://www.agentskills.in/api/skills`
- Implements caching with TTLs (5min for search, 1hr for content)
- Downloads from raw GitHub URLs
- CAAMP could use proper HTTP client (fetch/axios) instead of curl

---

## Domain: Instructions/Injection (lib/injection-registry.sh, injection-config.sh, injection.sh)

### Bash Functions (lib/injection-registry.sh) - 0 exported functions, constants only

| Constant | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `INJECTION_TARGETS` | lib/injection-registry.sh | List of injectable files | `instructionsConfig.targets` | pending |
| `INJECTION_MARKER_START` | lib/injection-registry.sh | Start marker for CLEO blocks | `instructionsConfig.markerStart` | pending |
| `INJECTION_MARKER_END` | lib/injection-registry.sh | End marker for CLEO blocks | `instructionsConfig.markerEnd` | pending |
| `INJECTION_VERSION_PATTERN` | lib/injection-registry.sh | Regex for version extraction | `instructionsConfig.versionPattern` | pending |
| `INJECTION_TEMPLATE_MAIN` | lib/injection-registry.sh | Path to main injection template | `instructionsConfig.templateMain` | pending |
| `INJECTION_TEMPLATE_DIR` | lib/injection-registry.sh | Path to agent template directory | `instructionsConfig.templateDir` | pending |
| `INJECTION_HEADERS` | lib/injection-registry.sh | Agent-specific header map (empty) | `instructionsConfig.headers` | pending |
| `INJECTION_VALIDATION_KEYS` | lib/injection-registry.sh | Validation key names for JSON | `instructionsConfig.validationKeys` | pending |

### Bash Functions (lib/injection-config.sh) - 6 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `injection_is_valid_target` | lib/injection-config.sh | Check if file is valid injection target | `instructionsManager.isValidTarget()` | pending |
| `injection_get_targets` | lib/injection-config.sh | Get list of injection targets as array | `instructionsManager.getTargets()` | pending |
| `injection_get_header_path` | lib/injection-config.sh | Get header template path for target | `instructionsManager.getHeaderPath()` | pending |
| `injection_get_template_path` | lib/injection-config.sh | Get main template path | `instructionsManager.getTemplatePath()` | pending |
| `injection_get_validation_key` | lib/injection-config.sh | Get validation key for JSON output | `instructionsManager.getValidationKey()` | pending |
| `injection_has_block` | lib/injection-config.sh | Check if file has injection block | `instructionsManager.hasBlock()` | pending |

### Bash Functions (lib/injection.sh) - 7 functions

| Function | File | Description | CAAMP Replacement | Status |
|----------|------|-------------|-------------------|--------|
| `injection_update` | lib/injection.sh | Update or add injection to target file | `instructionsManager.update()` | pending |
| `injection_check` | lib/injection.sh | Check injection status for target file | `instructionsManager.check()` | pending |
| `injection_check_all` | lib/injection.sh | Check all targets, return combined status | `instructionsManager.checkAll()` | pending |
| `injection_apply` | lib/injection.sh | Apply injection content to file (internal) | `instructionsManager.apply()` | pending |
| `injection_update_all` | lib/injection.sh | Update all injectable files in project | `instructionsManager.updateAll()` | pending |
| `injection_get_summary` | lib/injection.sh | Get compact injection summary | `instructionsManager.getSummary()` | pending |

### Notes
- 3 injection targets: CLAUDE.md, AGENTS.md, GEMINI.md
- Marker format: `<!-- CLEO:START -->` ... `<!-- CLEO:END -->`
- Uses @-reference pattern (`@.cleo/templates/AGENT-INJECTION.md`) instead of inline content
- CAAMP should handle marker-based block insertion/replacement in markdown files

---

## Domain: CLEO-Only (NOT moving to CAAMP) - 48 functions

These functions are CLEO-specific orchestration, protocol injection, and task management. They stay in bash.

### lib/skill-dispatch.sh - 23 functions

| Function | File | Description | Rationale |
|----------|------|-------------|-----------|
| `skill_select_for_task` | lib/skill-dispatch.sh | Select skill based on task metadata | CLEO orchestrator-specific |
| `skill_dispatch_validate` | lib/skill-dispatch.sh | Validate dispatch configuration | CLEO protocol enforcement |
| `skill_inject` | lib/skill-dispatch.sh | Inject skill content into prompt | CLEO subagent architecture |
| `skill_inject_for_task` | lib/skill-dispatch.sh | Inject skill for specific task | CLEO subagent architecture |
| `skill_get_dispatch_triggers` | lib/skill-dispatch.sh | Get dispatch triggers for skill | CLEO orchestrator-specific |
| `skill_matches_labels` | lib/skill-dispatch.sh | Check if skill matches task labels | CLEO orchestrator-specific |
| `skill_matches_keywords` | lib/skill-dispatch.sh | Check if skill matches keywords | CLEO orchestrator-specific |
| `skill_matches_type` | lib/skill-dispatch.sh | Check if skill matches task type | CLEO orchestrator-specific |
| `skill_list_with_triggers` | lib/skill-dispatch.sh | List skills with dispatch triggers | CLEO orchestrator-specific |
| `skill_find_by_trigger` | lib/skill-dispatch.sh | Find skill by trigger keyword | CLEO orchestrator-specific |
| `get_skills_by_category` | lib/skill-dispatch.sh | Get skills grouped by category | CLEO orchestrator-specific |
| `skill_dispatch_by_category` | lib/skill-dispatch.sh | Dispatch by category | CLEO orchestrator-specific |
| `skill_get_tier` | lib/skill-dispatch.sh | Get skill tier level | CLEO orchestrator-specific |
| `skill_is_tier` | lib/skill-dispatch.sh | Check if skill is specific tier | CLEO orchestrator-specific |
| `skill_dispatch_by_keywords` | lib/skill-dispatch.sh | Dispatch using keyword matching | CLEO orchestrator-specific |
| `skill_dispatch_by_type` | lib/skill-dispatch.sh | Dispatch using task type matching | CLEO orchestrator-specific |
| `skill_dispatch_by_protocol` | lib/skill-dispatch.sh | Dispatch using protocol matching | CLEO orchestrator-specific |
| `skill_get_metadata` | lib/skill-dispatch.sh | Get full skill metadata for dispatch | CLEO orchestrator-specific |
| `skill_get_references` | lib/skill-dispatch.sh | Get skill reference files | CLEO orchestrator-specific |
| `skill_check_compatibility` | lib/skill-dispatch.sh | Check skill compatibility | CLEO orchestrator-specific |
| `skill_list_by_tier` | lib/skill-dispatch.sh | List skills filtered by tier | CLEO orchestrator-specific |
| `skill_auto_dispatch` | lib/skill-dispatch.sh | Auto-select skill for task | CLEO orchestrator-specific |
| `skill_prepare_spawn` | lib/skill-dispatch.sh | Prepare full spawn prompt JSON | CLEO orchestrator-specific |
| `skill_prepare_spawn_multi` | lib/skill-dispatch.sh | Prepare multi-task spawn | CLEO orchestrator-specific |

### lib/token-inject.sh - 17 functions

| Function | File | Description | Rationale |
|----------|------|-------------|-----------|
| `ti_set_defaults` | lib/token-inject.sh | Set default token values | CLEO template system |
| `ti_validate_required` | lib/token-inject.sh | Validate required tokens are set | CLEO template system |
| `ti_inject_tokens` | lib/token-inject.sh | Replace {{TOKEN}} in template | CLEO template system |
| `ti_load_template` | lib/token-inject.sh | Load template file with injection | CLEO template system |
| `ti_list_tokens` | lib/token-inject.sh | List all known tokens | CLEO template system |
| `ti_get_default` | lib/token-inject.sh | Get default value for token | CLEO template system |
| `ti_clear_all` | lib/token-inject.sh | Clear all token values | CLEO template system |
| `ti_set_context` | lib/token-inject.sh | Set context for token resolution | CLEO template system |
| `ti_set_task_context` | lib/token-inject.sh | Set task-specific context | CLEO template system |
| `ti_extract_manifest_summaries` | lib/token-inject.sh | Extract manifest summaries | CLEO template system |
| `ti_extract_next_task_ids` | lib/token-inject.sh | Extract next task IDs | CLEO template system |
| `ti_reload_tokens` | lib/token-inject.sh | Reload tokens from placeholders.json | CLEO template system |
| `ti_populate_skill_specific_tokens` | lib/token-inject.sh | Populate skill-specific tokens | CLEO template system |
| `validate_token_value` | lib/token-inject.sh | Validate individual token value | CLEO template system |
| `ti_validate_all_tokens` | lib/token-inject.sh | Validate all tokens | CLEO template system |
| `ti_verify_all_resolved` | lib/token-inject.sh | Verify no unresolved tokens | CLEO template system |
| `ti_inject_and_verify` | lib/token-inject.sh | Inject and verify all resolved | CLEO template system |
| `ti_get_session_id` | lib/token-inject.sh | Get current session ID | CLEO session system |
| `ti_set_full_context` | lib/token-inject.sh | Set full context for spawning | CLEO template system |

### lib/subagent-inject.sh - 8 functions

| Function | File | Description | Rationale |
|----------|------|-------------|-----------|
| `subagent_prepare` | lib/subagent-inject.sh | Prepare subagent context | CLEO protocol injection |
| `subagent_get_task_context` | lib/subagent-inject.sh | Get task context for subagent | CLEO protocol injection |
| `subagent_inject_protocol` | lib/subagent-inject.sh | Inject RFC 2119 protocol into prompt | CLEO protocol injection |
| `orchestrator_spawn_skill` | lib/subagent-inject.sh | Full orchestrator skill spawn workflow | CLEO protocol injection |
| `orchestrator_spawn_minimal` | lib/subagent-inject.sh | Minimal spawn without full protocol | CLEO protocol injection |
| `orchestrator_validate_spawn` | lib/subagent-inject.sh | Validate spawn prompt completeness | CLEO protocol injection |
| `subagent_list_required_tokens` | lib/subagent-inject.sh | List required tokens for subagent | CLEO protocol injection |
| `subagent_get_protocol_path` | lib/subagent-inject.sh | Get protocol base path | CLEO protocol injection |

### lib/orchestrator-spawn.sh - 1 function

| Function | File | Description | Rationale |
|----------|------|-------------|-----------|
| `orchestrator_spawn_for_task` | lib/orchestrator-spawn.sh | Single-function orchestrator spawning | CLEO orchestrator-specific |

### Notes
- All orchestration, dispatch, token injection, and protocol functions are deeply tied to CLEO's 2-tier subagent architecture
- These operate on CLEO's task system, session protocol, and RCSD lifecycle
- No benefit to moving these to CAAMP as they are consumer-specific logic

---

## CAAMP Domain Mapping Summary

| CAAMP Domain | Bash File(s) | Function Count | Status |
|-------------|-------------|----------------|--------|
| Provider/Registry | lib/agent-registry.sh | 27 | All pending |
| Provider/Config | lib/agent-config.sh | 27 | All pending |
| MCP | lib/mcp-config.sh | 30 | All pending |
| Skills/Install | lib/skills-install.sh | 7 | All pending |
| Skills/Discovery | lib/skill-discovery.sh | 7 | All pending |
| Skills/Validate | lib/skill-validate.sh | 10 | All pending |
| Skills/Version | lib/skills-version.sh | 8 | All pending |
| Skills/Marketplace | lib/skillsmp.sh | 5 | All pending |
| Instructions | lib/injection-*.sh | 13 + 8 constants | All pending |
| **TOTAL CAAMP-bound** | | **104 functions + 8 constants** | **0 done** |

| CLEO-Only Domain | Bash File(s) | Function Count |
|-----------------|-------------|----------------|
| Skill Dispatch | lib/skill-dispatch.sh | 24 |
| Token Injection | lib/token-inject.sh | 19 |
| Subagent Injection | lib/subagent-inject.sh | 8 |
| Orchestrator Spawn | lib/orchestrator-spawn.sh | 1 |
| **TOTAL CLEO-only** | | **48 functions** |

---

## Existing CAAMP Usage in CLEO

**None.** As of 2026-02-11:
- No `@cleocode/caamp` dependency in any `package.json`
- No TypeScript imports from `caamp` anywhere in the codebase
- The CAAMP epic (T4332) is in `pending` status
- All provider/MCP/skills/injection functionality remains in bash

## Migration Considerations

1. **Provider Registry + Config Consolidation**: `agent-registry.sh` (27 funcs) and `agent-config.sh` (27 funcs) have significant overlap. CAAMP should provide a unified ProviderRegistry class that covers both.

2. **MCP Config Complexity**: The MCP domain has 6 format-specific merge strategies (standard JSON, OpenCode, VS Code, Zed, Codex TOML, Goose YAML). CAAMP must support all of these plus JSONC parsing.

3. **Skills Domain Fragmentation**: Skills functionality is spread across 5 bash files (install, discovery, validate, version, marketplace). CAAMP should provide a cohesive Skills module with sub-namespaces.

4. **Injection System**: The marker-based injection system (`<!-- CLEO:START -->`) is specific to instruction file management. CAAMP needs to handle markdown block insertion/replacement with awk-level precision.

5. **No Breaking Change Path**: Since 0 functions are currently converted, the V2 migration is a clean-slate TypeScript rewrite. CLEO's bash files can call CAAMP via `node -e` or a thin CLI wrapper during transition.
